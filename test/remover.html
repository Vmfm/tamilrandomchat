<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI BG Remover</title>
<style>
body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #1e1e1e;
    color: #fff;
}
header {
    text-align: center;
    padding: 15px;
    background: #0d6efd;
    font-size: 1.5em;
}
.container {
    max-width: 900px;
    margin: auto;
    padding: 15px;
}
.controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
}
button, input[type="color"], input[type="file"] {
    padding: 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}
button { background: #0d6efd; color: #fff; }
button:hover { background: #0954b3; }
canvas { 
    display: block; 
    margin: 15px auto; 
    max-width: 100%;
    border: 2px dashed #555;
}
.color-presets button {
    width: 40px;
    height: 40px;
    padding: 0;
    border-radius: 50%;
    border: 2px solid #fff;
}
@media(max-width:600px){
    .controls { flex-direction: column; }
}
</style>
</head>
<body>

<header>ðŸ–¼ AI Background Remover</header>

<div class="container">
    <div class="controls">
        <input type="file" id="upload" multiple accept="image/*">
        <button onclick="processAll()">Remove BG</button>
        <input type="color" id="bgColor" value="#ffffff" title="Pick background color">
        <button onclick="applyColor()">Apply Color</button>
        <button onclick="downloadAll()">Download All</button>
    </div>
    
    <div class="color-presets controls">
        <button style="background:#ffffff;" onclick="applyPreset('#ffffff')"></button>
        <button style="background:#000000;" onclick="applyPreset('#000000')"></button>
        <button style="background:#ff0000;" onclick="applyPreset('#ff0000')"></button>
        <button style="background:#00ff00;" onclick="applyPreset('#00ff00')"></button>
        <button style="background:#0000ff;" onclick="applyPreset('#0000ff')"></button>
        <button style="background:linear-gradient(to right, red, yellow);" onclick="applyPresetGradient()"></button>
    </div>

    <div id="canvasContainer"></div>
</div>

<!-- TensorFlow.js + BodyPix (U-2-Net style) -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix@2.2.0/dist/body-pix.min.js"></script>

<script>
let images = [];
let canvases = [];

const uploadInput = document.getElementById("upload");
uploadInput.addEventListener("change", e => {
    const files = e.target.files;
    const container = document.getElementById("canvasContainer");
    container.innerHTML = "";
    images = [];
    canvases = [];

    Array.from(files).forEach(file => {
        const reader = new FileReader();
        const img = new Image();
        reader.onload = () => {
            img.onload = () => {
                const canvas = document.createElement("canvas");
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext("2d");
                ctx.drawImage(img,0,0);
                container.appendChild(canvas);
                images.push(img);
                canvases.push(canvas);
            };
            img.src = reader.result;
        };
        reader.readAsDataURL(file);
    });
});

// Load BodyPix model
let net;
async function loadModel() {
    net = await bodyPix.load({architecture:'MobileNetV1', outputStride:16, multiplier:0.75});
}
loadModel();

// Process all images
async function processAll(){
    if(!net) { alert("Model still loading..."); return; }

    for(let i=0;i<canvases.length;i++){
        const canvas = canvases[i];
        const ctx = canvas.getContext("2d");
        const segmentation = await net.segmentPerson(canvas,{
            internalResolution:'medium',
            segmentationThreshold:0.7
        });
        const imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
        const d = imgData.data;

        for(let y=0;y<canvas.height;y++){
            for(let x=0;x<canvas.width;x++){
                const n = y*canvas.width + x;
                if(segmentation.data[n] === 0){ d[n*4 + 3]=0; } // make background transparent
            }
        }
        ctx.putImageData(imgData,0,0);
    }
}

// Apply background color
function applyColor(){
    const color = document.getElementById("bgColor").value;
    canvases.forEach(canvas=>{
        const ctx = canvas.getContext("2d");
        ctx.globalCompositeOperation = "destination-over";
        ctx.fillStyle = color;
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.globalCompositeOperation = "source-over";
    });
}

// Preset colors
function applyPreset(color){ document.getElementById("bgColor").value = color; applyColor(); }
function applyPresetGradient(){
    canvases.forEach(canvas=>{
        const ctx = canvas.getContext("2d");
        let grad = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
        grad.addColorStop(0,'red');
        grad.addColorStop(1,'yellow');
        ctx.globalCompositeOperation = "destination-over";
        ctx.fillStyle = grad;
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.globalCompositeOperation = "source-over";
    });
}

// Download all images
function downloadAll(){
    canvases.forEach((canvas,i)=>{
        const link = document.createElement("a");
        link.download = "image_"+(i+1)+".png";
        link.href = canvas.toDataURL("image/png");
        link.click();
    });
}
</script>

</body>
</html>
