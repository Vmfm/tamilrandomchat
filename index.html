<!DOCTYPE html>
<html>
<head>
  <title>WebRTC Manual Video Chat</title>
  <style>
    video { width: 45%; margin: 10px; border: 1px solid #ccc; }
    textarea { width: 90%; height: 100px; }
  </style>
</head>
<body>
  <h2>Manual WebRTC Video Chat (No Server)</h2>

  <video id="localVideo" autoplay muted playsinline></video>
  <video id="remoteVideo" autoplay playsinline></video>

  <h3>Step 1: Create Offer</h3>
  <button onclick="createOffer()">Generate Offer</button>
  <textarea id="offer" readonly></textarea>

  <h3>Step 2: Paste Offer & Generate Answer</h3>
  <textarea id="remoteOffer" placeholder="Paste remote offer here"></textarea>
  <button onclick="createAnswer()">Generate Answer</button>
  <textarea id="answer" readonly></textarea>

  <h3>Step 3: Paste Answer</h3>
  <textarea id="remoteAnswer" placeholder="Paste remote answer here"></textarea>
  <button onclick="addAnswer()">Connect</button>

  <script>
    let localStream;
    let pc = new RTCPeerConnection();

    const localVideo = document.getElementById('localVideo');
    const remoteVideo = document.getElementById('remoteVideo');

    navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {
      localVideo.srcObject = stream;
      stream.getTracks().forEach(track => pc.addTrack(track, stream));
    });

    pc.ontrack = event => {
      remoteVideo.srcObject = event.streams[0];
    };

    pc.onicecandidate = event => {
      if (event.candidate) return;
      document.getElementById('offer').value = JSON.stringify(pc.localDescription);
      document.getElementById('answer').value = JSON.stringify(pc.localDescription);
    };

    async function createOffer() {
      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
    }

    async function createAnswer() {
      const remoteOffer = JSON.parse(document.getElementById('remoteOffer').value);
      await pc.setRemoteDescription(remoteOffer);
      const answer = await pc.createAnswer();
      await pc.setLocalDescription(answer);
    }

    async function addAnswer() {
      const remoteAnswer = JSON.parse(document.getElementById('remoteAnswer').value);
      await pc.setRemoteDescription(remoteAnswer);
    }
  </script>
</body>
</html>
