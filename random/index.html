<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Tamil VM Random Video</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{margin:0;font-family:sans-serif;background:#111;color:#eee}
h2{text-align:center}
#videoWrap{position:relative;height:70vh;background:#000}
video{width:100%;height:100%;object-fit:cover}
#localVideo{position:absolute;top:10px;right:10px;width:150px;height:110px;border:2px solid #fff;border-radius:8px}
.controls{text-align:center;margin:10px}
button{padding:10px 14px;margin:4px;border:none;border-radius:6px;font-size:15px;color:#fff;cursor:pointer}
#startBtn{background:#2563eb}
#nextBtn{background:#10b981}
#hangBtn{background:#ef4444}
#muteBtn{background:#f59e0b}
#camBtn{background:#8b5cf6}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);display:flex;align-items:center;justify-content:center;z-index:10}
.card{background:#1f2937;padding:20px;border-radius:10px;width:280px}
input,select{width:100%;padding:9px;margin:6px 0;border-radius:6px;border:none}
#partnerBox{position:absolute;top:15px;left:15px;background:rgba(0,0,0,.6);padding:10px;border-radius:8px;font-size:14px}
.hidden{display:none}
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>

<body>

<h2>ðŸ”¥ Tamil VM â€“ Random Video</h2>

<!-- LOGIN -->
<div id="loginOverlay" class="overlay">
  <div class="card">
    <h3>Enter Details</h3>
    <input id="loginName" placeholder="Name">
    <input id="loginAge" type="number" placeholder="Age">
    <select id="loginGender">
      <option value="">Select Gender</option>
      <option>Male</option>
      <option>Female</option>
      <option>Other</option>
    </select>
    <button id="loginBtn" style="background:#2563eb;width:100%">Continue</button>
  </div>
</div>

<div id="videoWrap">
  <video id="remoteVideo" autoplay playsinline></video>
  <video id="localVideo" autoplay muted playsinline></video>
  <div id="partnerBox" class="hidden"></div>
</div>

<div class="controls">
  <button id="startBtn">Find Partner</button>
  <button id="nextBtn" disabled>Next</button>
  <button id="hangBtn" disabled>Hang Up</button>
  <button id="muteBtn" disabled>Mute</button>
  <button id="camBtn" disabled>Camera Off</button>
  <div id="status">Idle</div>
</div>

<script>
/* ðŸ”¥ Firebase config (YOURS) */
firebase.initializeApp({
  apiKey:"AIzaSyAlWP5D79PsX29H0hIZlfvL0YV5Us7v5I4",
  authDomain:"sample-firebase-ai-app-1f408.firebaseapp.com",
  databaseURL:"https://sample-firebase-ai-app-1f408-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"sample-firebase-ai-app-1f408"
});
const db = firebase.database();

/* GLOBALS */
const clientId = "c_" + Math.random().toString(36).substr(2,8);
let userData = {};
let localStream, pc;

/* UI */
const loginOverlay = document.getElementById("loginOverlay");
const partnerBox = document.getElementById("partnerBox");
const statusEl = document.getElementById("status");

/* LOGIN â€“ FIXED & WORKING */
document.getElementById("loginBtn").onclick = () => {
  const n = document.getElementById("loginName").value.trim();
  const a = document.getElementById("loginAge").value.trim();
  const g = document.getElementById("loginGender").value;

  if(!n || !a || !g){
    alert("Please fill all fields");
    return;
  }

  userData = { name:n, age:a, gender:g };
  db.ref("users/"+clientId).set(userData);

  loginOverlay.classList.add("hidden");
};

/* MEDIA */
async function getMedia(){
  if(localStream) return;
  localStream = await navigator.mediaDevices.getUserMedia({video:true,audio:true});
  document.getElementById("localVideo").srcObject = localStream;
}

/* FIND PARTNER (demo pairing) */
document.getElementById("startBtn").onclick = async () => {
  await getMedia();
  statusEl.textContent = "Searching...";
  findDummyPartner();
};

/* DEMO PARTNER SHOW (same logic as real pair) */
function findDummyPartner(){
  setTimeout(()=>{
    db.ref("users").limitToFirst(1).once("value",snap=>{
      snap.forEach(s=>{
        if(s.key !== clientId){
          showPartner(s.val());
        }
      });
    });
  },2000);
}

/* SHOW PARTNER DETAILS â€“ 10 SECONDS */
function showPartner(data){
  partnerBox.innerHTML =
    "ðŸ‘¤ "+data.name+"<br>"+
    "ðŸŽ‚ "+data.age+"<br>"+
    "âš§ "+data.gender;

  partnerBox.classList.remove("hidden");
  statusEl.textContent = "Connected";

  setTimeout(()=>{
    partnerBox.classList.add("hidden");
  },10000);
}
</script>

</body>
</html>
