<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Tamil VM Random Video</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{margin:0;font-family:sans-serif;background:#111;color:#fff}

#loginScreen{
  position:fixed;inset:0;background:#111;
  display:flex;align-items:center;justify-content:center;z-index:999
}
input,select,button{padding:10px;margin:5px;width:100%}

#videoContainer{
  position:relative;
  height:70vh;
  background:black;
  overflow:hidden;
}

video{
  width:100%;
  height:100%;
  object-fit:cover;
}

#localVideo{
  position:absolute;
  top:10px;right:10px;
  width:150px;height:110px;
  border:2px solid white;
  z-index:2;
}

/* ðŸ”„ Waiting Overlay */
#waitingOverlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.7);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:10px;
  z-index:1;
}

.spinner{
  width:40px;height:40px;
  border:5px solid #777;
  border-top:5px solid #fff;
  border-radius:50%;
  animation:spin 1s linear infinite;
}

@keyframes spin{
  0%{transform:rotate(0deg)}
  100%{transform:rotate(360deg)}
}

#partnerInfo{
  position:absolute;
  bottom:10px;left:10px;
  background:rgba(0,0,0,.6);
  padding:8px;
  border-radius:6px;
  display:none;
  z-index:2;
}

.controls{text-align:center;margin:10px}
button{cursor:pointer}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>

<body>

<!-- ðŸ” LOGIN -->
<div id="loginScreen">
  <div style="width:300px">
    <h2>Tamil VM Login</h2>
    <input id="nameInput" placeholder="Name">
    <input id="ageInput" type="number" placeholder="Age">

    <select id="genderInput">
      <option value="">Your Gender</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
    </select>

    <select id="interestInput">
      <option value="">Interested In</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
      <option value="Any">Any</option>
    </select>

    <button id="loginBtn">Continue</button>
  </div>
</div>

<h3 align="center">ðŸ”¥ Tamil VM Random Video</h3>

<div id="videoContainer">
  <video id="remoteVideo" autoplay playsinline></video>
  <video id="localVideo" autoplay muted playsinline></video>

  <!-- ðŸ”„ Waiting Overlay -->
  <div id="waitingOverlay">
    <div class="spinner"></div>
    <div>Waiting for partner...</div>
  </div>

  <div id="partnerInfo"></div>
</div>

<div class="controls">
  <button id="startBtn">Find Partner</button>
  <button id="hangBtn" disabled>Hang Up</button>
  <button id="fullscreenBtn" disabled>ðŸ–µ Fullscreen</button>
</div>

<script>
/* ðŸ”¥ FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyAlWP5D79PsX29H0hIZlfvL0YV5Us7v5I4",
  databaseURL:"https://sample-firebase-ai-app-1f408-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db=firebase.database();

/* ðŸ” LOGIN */
const loginScreen=document.getElementById("loginScreen");
const nameInput=document.getElementById("nameInput");
const ageInput=document.getElementById("ageInput");
const genderInput=document.getElementById("genderInput");
const interestInput=document.getElementById("interestInput");

let profile=JSON.parse(localStorage.getItem("vm_profile"));
if(profile) loginScreen.style.display="none";

loginBtn.onclick=()=>{
  if(!nameInput.value||!ageInput.value||!genderInput.value||!interestInput.value){
    alert("Fill all fields");return;
  }
  profile={
    name:nameInput.value,
    age:ageInput.value,
    gender:genderInput.value,
    interest:interestInput.value
  };
  localStorage.setItem("vm_profile",JSON.stringify(profile));
  loginScreen.style.display="none";
};

/* ðŸŽ¥ CAMERA */
let localStream=null;
async function startCamera(){
  if(localStream) return;
  localStream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});
  localVideo.srcObject=localStream;
}

/* ðŸ“ž MATCH (DEMO SIMPLE CONNECT) */
startBtn.onclick=async()=>{
  await startCamera();           // âœ… camera opens here
  waitingOverlay.style.display="flex";
  setTimeout(connectDemo,3000);  // demo partner connect
};

function connectDemo(){
  remoteVideo.srcObject=localStream; // demo loopback
  waitingOverlay.style.display="none";
  partnerInfo.innerHTML="ðŸ‘¤ Partner<br>ðŸŽ‚ 25<br>âš§ Female";
  partnerInfo.style.display="block";
  hangBtn.disabled=false;
  fullscreenBtn.disabled=false;
}

/* ðŸ–µ FULLSCREEN */
fullscreenBtn.onclick=()=>{
  if(!document.fullscreenElement){
    videoContainer.requestFullscreen();
  }else{
    document.exitFullscreen();
  }
};

hangBtn.onclick=()=>location.reload();
</script>

</body>
</html>
