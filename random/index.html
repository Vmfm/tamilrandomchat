<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Tamil VM â€“ Random Video</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{margin:0;font-family:sans-serif;background:#111;color:#eee}
h2{text-align:center}

/* VIDEO */
#videoWrap{position:relative;height:70vh;background:#000}
video{width:100%;height:100%;object-fit:cover}
#localVideo{
 position:absolute;top:10px;right:10px;
 width:150px;height:110px;
 border:2px solid #fff;border-radius:8px;z-index:2
}

/* CONTROLS */
.controls{text-align:center;margin:10px}
button{
 padding:10px 14px;margin:4px;
 border:none;border-radius:6px;
 font-size:15px;color:#fff;cursor:pointer
}
#startBtn{background:#2563eb}
#nextBtn{background:#10b981}
#hangBtn{background:#ef4444}
#muteBtn{background:#f59e0b}
#camBtn{background:#8b5cf6}
#fullBtn{background:#374151}
#reportBtn{background:#dc2626}
#blockBtn{background:#7c2d12}

/* LOGIN + WAIT OVERLAY */
.overlay{
 position:fixed;inset:0;
 background:rgba(0,0,0,.75);
 display:flex;align-items:center;justify-content:center;
 z-index:10
}
.card{background:#1f2937;padding:20px;border-radius:10px;width:280px}
input,select{
 width:100%;padding:9px;margin:6px 0;
 border-radius:6px;border:none
}

/* SPINNER */
#waitingOverlay{
 position:absolute;inset:0;
 background:rgba(0,0,0,.7);
 display:flex;flex-direction:column;
 align-items:center;justify-content:center;
 z-index:3
}
.spinner{
 width:40px;height:40px;
 border:5px solid #888;
 border-top:5px solid #fff;
 border-radius:50%;
 animation:spin 1s linear infinite
}
@keyframes spin{
 0%{transform:rotate(0deg)}
 100%{transform:rotate(360deg)}
}

/* PARTNER INFO */
#partnerBox{
 position:absolute;top:15px;left:15px;
 background:rgba(0,0,0,.6);
 padding:10px;border-radius:8px;
 font-size:14px;z-index:4
}

.hidden{display:none}
</style>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>

<body>

<h2>ðŸ”¥ Tamil VM â€“ Random Video</h2>

<!-- LOGIN -->
<div id="loginOverlay" class="overlay hidden">
  <div class="card">
    <h3>Enter Details</h3>
    <input id="loginName" placeholder="Name">
    <input id="loginAge" type="number" placeholder="Age">
    <select id="loginGender">
      <option value="">Select Gender</option>
      <option>Male</option>
      <option>Female</option>
      <option>Other</option>
    </select>
    <button id="loginBtn" style="background:#2563eb;width:100%">Continue</button>
  </div>
</div>

<div id="videoWrap">
  <video id="remoteVideo" autoplay playsinline></video>
  <video id="localVideo" autoplay muted playsinline></video>

  <!-- WAITING SPINNER -->
  <div id="waitingOverlay" class="hidden">
    <div class="spinner"></div>
    <div style="margin-top:10px">Waiting for partner...</div>
  </div>

  <!-- PARTNER INFO -->
  <div id="partnerBox" class="hidden"></div>
</div>

<div class="controls">
  <button id="startBtn">Find Partner</button>
  <button id="nextBtn" disabled>Next</button>
  <button id="hangBtn" disabled>Hang Up</button>
  <button id="muteBtn" disabled>Mute</button>
  <button id="camBtn" disabled>Camera Off</button>
  <button id="fullBtn">Fullscreen</button>
  <button id="reportBtn" disabled>Report</button>
  <button id="blockBtn" disabled>Block</button>
  <div id="status">Idle</div>
</div>

<script>
/* ðŸ”¥ Firebase (YOUR PROJECT) */
firebase.initializeApp({
 apiKey:"AIzaSyAlWP5D79PsX29H0hIZlfvL0YV5Us7v5I4",
 authDomain:"sample-firebase-ai-app-1f408.firebaseapp.com",
 databaseURL:"https://sample-firebase-ai-app-1f408-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId:"sample-firebase-ai-app-1f408"
});
const db=firebase.database();

/* GLOBAL */
const clientId=localStorage.getItem("vm_id")||
 ("c_"+Math.random().toString(36).substr(2,8));
localStorage.setItem("vm_id",clientId);

let userData=null;
let currentPartnerId=null;
let blocked=JSON.parse(localStorage.getItem("vm_blocked")||"[]");

/* UI */
const loginOverlay=document.getElementById("loginOverlay");
const waitingOverlay=document.getElementById("waitingOverlay");
const partnerBox=document.getElementById("partnerBox");
const statusEl=document.getElementById("status");

/* AUTO LOGIN */
const saved=localStorage.getItem("vm_user");
if(saved){
 userData=JSON.parse(saved);
}else{
 loginOverlay.classList.remove("hidden");
}

/* LOGIN */
loginBtn.onclick=()=>{
 const n=loginName.value.trim();
 const a=loginAge.value.trim();
 const g=loginGender.value;
 if(!n||!a||!g) return alert("Fill all details");
 userData={name:n,age:a,gender:g};
 localStorage.setItem("vm_user",JSON.stringify(userData));
 db.ref("users/"+clientId).set(userData);
 loginOverlay.classList.add("hidden");
};

/* MEDIA */
async function getMedia(){
 const s=await navigator.mediaDevices.getUserMedia({video:true,audio:true});
 localVideo.srcObject=s;
}

/* START */
startBtn.onclick=async()=>{
 await getMedia();
 waitingOverlay.classList.remove("hidden");
 statusEl.textContent="Searching...";
 db.ref("queue").push({id:clientId,ts:Date.now()});
};

/* MATCH */
db.ref("queue").on("child_added",snap=>{
 const otherId=snap.val().id;
 if(otherId===clientId) return;
 if(blocked.includes(otherId)) return;
 currentPartnerId=otherId;
 db.ref("queue/"+snap.key).remove();
 db.ref("users/"+otherId).once("value").then(s=>{
  waitingOverlay.classList.add("hidden");
  showPartner(s.val());
 });
});

/* SHOW PARTNER */
function showPartner(d){
 partnerBox.innerHTML=
  `ðŸ‘¤ ${d.name}<br>ðŸŽ‚ ${d.age}<br>âš§ ${d.gender}`;
 partnerBox.classList.remove("hidden");
 statusEl.textContent="Connected";
 reportBtn.disabled=false;
 blockBtn.disabled=false;
 setTimeout(()=>partnerBox.classList.add("hidden"),10000);
}

/* REPORT */
reportBtn.onclick=()=>{
 if(!currentPartnerId) return;
 db.ref("reports").push({
  from:clientId,to:currentPartnerId,time:Date.now()
 });
 alert("User reported");
};

/* BLOCK */
blockBtn.onclick=()=>{
 if(!currentPartnerId) return;
 blocked.push(currentPartnerId);
 localStorage.setItem("vm_blocked",JSON.stringify(blocked));
 alert("User blocked");
};

/* FULLSCREEN */
fullBtn.onclick=()=>{
 if(!document.fullscreenElement)
  document.documentElement.requestFullscreen();
 else document.exitFullscreen();
};
</script>

</body>
</html>
